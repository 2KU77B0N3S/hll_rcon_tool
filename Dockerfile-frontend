FROM node:15-stretch

WORKDIR /code

RUN apt-get update -y && apt-get install -y nginx apache2-utils


RUN mkdir /pw

COPY rcongui/package.json .
COPY rcongui/package-lock.json .

RUN npm install

ENV REACT_APP_API_URL /api/

COPY rcongui/src/ src/
COPY rcongui/public/ public/
COPY rcongui/entrypoint.sh .

RUN chmod +x /code/entrypoint.sh

RUN npm run build
COPY rcongui/nginx.conf /etc/nginx/sites-available/default
COPY .git/ .git/

RUN rm -rf src/
RUN rm -rf public/
RUN rm -rf node_modules/

WORKDIR /var/www

RUN mv /code/build /var/www/

ENTRYPOINT [ "/code/entrypoint.sh" ]
